YUI.add("gallery-soundmanager-player",function(A){var E="SMPlayer",I=A.ClassNameManager.getClassName(E.toLowerCase(),"a").slice(0,-1),Q="."+I,K="load",G="fail",J="url",C="title",N="boundingBox",T="contentBox",U="play",M="elapsed",D="total",F="scrubber",V="bar",H="loadbar",B="volbar",O="playbar",S="volumeControl",P="timeControl",R="position",L="width";A.namespace("SoundManager").Player=A.Base.create(E,A.Widget,[],{_cb:null,_sm:null,_smInit:null,_s:null,_loadFail:null,_drag:null,initializer:function(){var X={broadcast:2,fireOnce:true,emitFacade:true},W;A.Global.publish(this.name+":load",X);A.Global.publish(this.name+":fail",X);A.Global.on(this.name+":load",this._smLoaded,this);A.Global.on(this.name+":fail",this._smFailure,this);if(!A.config.win.soundManager&&typeof A.config.win.SM2_DEFER==="undefined"){A.config.win.SM2_DEFER=true;this._smLoad();}if(this.get("url")&&!this.get("title")){this.set("url",this.get("url"));}},destructor:function(){if(this._s&&typeof this._s.destruct==="function"){this._s.destruct();}this._cb=this._sm=this._smInit=this._s=this._loadFailr=this._drag=null;},renderUI:function(){var X=this.get("boundingBox"),W=this.get("contentBox"),Y=A.Node.create(A.substitute(this.get("BASIC_TEMPLATE"),{id:W.get("id"),className:W.get("className"),title:this.get("title"),playBtnClass:I+"play",titleClass:I+"title",time:(this.get("time")?A.substitute(this.get("TIME_CONTAINER_TEMPLATE"),{timeClass:I+"time",time:A.substitute(this.get("TIME_TEMPLATE"),{elapsedClass:I+"elapsed",separatorClass:I+"separator",totalClass:I+"total",elapsed:"0:00",total:"0:00"})}):""),scrubber:(this.get("scrubber")?A.substitute(this.get("SCRUBBER_TEMPLATE"),{scrubberClass:I+"scrubber",barClass:I+"bar",loadbarClass:I+"loadbar",playbarClass:I+"playbar"}):""),volumeBtn:(this.get("volumeControl")?A.substitute(this.get("VOLUME_BTN_TEMPLATE"),{volumeBtnClass:I+"volume-btn"}):""),volumeBar:(this.get("volumeControl")?A.substitute(this.get("VOLUME_BAR_TEMPLATE"),{volumeClass:I+"volume",barClass:I+"bar",volbarClass:I+"volbar"}):"")}));X.addClass(I+"loading");if(this.get("time")){X.addClass(I+"time-on");}if(this.get("scrubber")){X.addClass(I+"scrubber-on");}if(this.get("volumeControl")){X.addClass(I+"volume-on");}X.append(Y);W.remove();this._cb=Y;},bindUI:function(){this.publish("bind",{fireOnce:true,defaultFn:A.bind(function(){var a=this.get("boundingBox"),Z=(!this.get("scrubber")&&!this.get("volumeControl"))?a:a.one(Q+"play"),X=function(f,g){return(f-g.getX())/parseInt(g.getComputedStyle("width"),10);},d=A.bind(function(g,f){if(f.test(Q+"scrubber")){W(g);}else{this.set("volume",Math.floor(g*100));}},this),W=A.bind(function(f){this._sound(function(g){if(g.readyState===0){g.load();}f=Math.floor(f*((g.readyState===1)?g.durationEstimate:g.duration));f=(f>g.duration)?g.duration:f;this.set("position",f);});},this),b=function(f,g){f.preventDefault();g=g||f.currentTarget;if(f.type==="mousedown"){this._drag=true;d(X(f.clientX,g),g);}else{if(f.type==="mouseup"){this._drag=false;}else{if(f.type==="mouseout"){this._drag=false;}else{if(f.type==="mousemove"){if(this._drag){d(X(f.clientX,g),g);}}}}}},e,c,Y;e=a.all(Q+"bar");if(e.size()){e.on("mousedown",b,this);e.on("mouseup",b,this);e.on("mousemove",b,this);e.on("mouseleave",b,this);}if(this.get("scrubber")){Y=a.one(Q+"scrubber");if(!this.get("timeControl")){c=a.one(Q+"title");c.on("mousedown",b,this,Y);c.on("mouseup",b,this,Y);c.on("mousemove",b,this,Y);}A.on("key",function(f){this._sound(function(h){var g=(h.readyState===1)?h.durationEstimate:h.duration,j=15000/g,i=((this.get("position")||0)/g)+((f.keyCode===37)?-1*j:j);i=(i>1)?1:((i<0)?0:i);W(i||0);});},this._cb.one(Q+"play"),"down:39,37",this);}if(this.get("volumeControl")){volBar=a.one(Q+"volume");a.one(Q+"volume-btn").on("click",function(f){f.preventDefault();this._cb.toggleClass(I+"volume-open");},this);A.on("key",function(g){var f=this.get("volume"),h=(g.keyCode===37)?-10:10;this.set("volume",(f+h>100)?100:(f+h<0)?0:f+h);},this._cb.one(Q+"volume-btn"),"down:39,37",this);}Z.on("click",function(f){f.preventDefault();this.toggle();},this);this.after("urlChange",function(){this.stop();this._sound(function(f){f.destruct();this._s=null;this._sound();});});this.after("titleChange",function(f){this._cb.one(Q+"title").setContent(f.newVal);});this.after("positionChange",function(f){this._sound(function(g){g.setPosition(f.newVal);this.syncUI();});},this);this.after("volumeChange",function(f){this._sound(function(g){g.setVolume(f.newVal);this.syncUI();});});},this)});this.fire("bind");},syncUI:function(){var b=this._s,c,Z,Y,X,a,W;if(b&&this.get("scrubber")){if(b.readyState===1){this._cb.one(Q+"loadbar").setStyle("width",Math.floor((b.bytesLoaded/b.bytesTotal)*100)+"%");}c=(b.playState===1&&b.readyState>=1)?b.position:this.get("position");this._cb.one(Q+"playbar").setStyle("width",(((c/((b.readyState===1)?b.durationEstimate:b.duration))*100)||0)+"%");}if(this.get("volumeControl")){Z=this.get("volume");Y=this._cb.one(Q+"volume-btn");this._cb.one(Q+"volbar").setStyle("width",Z+"%");if(Z>50){Y.removeClass("("+I+"volume-half"+"|"+I+"volume-zero"+")");}else{if(Z>5){Y.replaceClass(I+"volume-zero",I+"volume-half");}else{Y.replaceClass(I+"volume-half",I+"volume-zero");}}}if(b&&this.get("time")){W=function(d){d=d/1000;return Math.floor(d/60)+":"+((d%60<10)?"0":"")+Math.floor(d%60);};X=(b.position)?b.position:this.get("position");a=(b.readyState===1)?b.durationEstimate:b.duration;this._cb.one(Q+"elapsed").setContent(W(X));this._cb.one(Q+"total").setContent(W(a));}},toggle:function(){this._sound(function(W){if(W.playState===0||W.paused){this.play();}else{this.pause();}});},play:function(){this._sound(function(W){W.play();this._cb.replaceClass("("+I+"stopped"+"|"+I+"paused"+")",I+"playing");this.fire("play");});},pause:function(){this._sound(function(W){W.pause();this._cb.replaceClass(I+"playing",I+"paused");this.fire("pause");});},stop:function(){this._sound(function(W){W.stop();this._cb.replaceClass("("+I+"paused"+"|"+I+"playing"+")",I+"stopped");this.fire("stop");
});},_smLoad:function(){A.Get.script(this.get("js"),{onSuccess:function(){A.config.win.soundManager=new SoundManager();this._sm=A.config.win.soundManager;this._sm.consoleOnly=true;this._sm.beginDelayedInit();this._sm.onready(A.bind(function(W){A.Global.fire(this.name+((W.success)?":load":":fail"));},this));},onFailure:function(){A.Global.fire(this.name+":fail");},context:this});},_smFailure:function(){var W=(console&&console.error)?console.error:alert;W("Failed to load SoundManager using JS url "+this.get("js")+" & SWF url "+this.get("swf"));delete A.config.win.soundManager;delete A.config.win.SM2_DEFER;},_smLoaded:function(){this._smInit=true;this._sm=A.config.win.soundManager;if(this.get("autoLoad")){this._sound();}this.after("render",function(){this.get("boundingBox").removeClass(I+"loading");this._cb.addClass(I+"stopped");},this);},_api:function(X){var W=A.bind(X,this);if(this._smInit){W(this._sm);}else{A.Global.on(this.name+":load",function(){W(this._sm);},this);}},_sound:function(X){var W=(typeof X==="function")?A.bind(X,this):function(){};if(this._s){W(this._s);}else{this._api(function(Y){var Z=(this.get("scrubber")||this.get("time"))?A.bind(this.syncUI,this):function(){};this._s=Y.createSound({id:this.get("contentBox").get("id"),url:this.get("url"),volume:this.get("volume"),whileloading:Z,whileplaying:Z,onload:A.bind(function(a){if(this._s.readyState==3&&this._s.bytesLoaded>0){this.fire("soundLoad");}},this),onid3:A.bind(function(){this.fire("id3Load");},this),onfinish:A.bind(function(){this.set("position",0);this.stop();},this)});if(this.get("autoLoad")){this._s.load();}W(this._s);});}}},{NAME:E,ATTRS:{js:{value:"soundmanager2.js"},swf:{value:null},url:{value:"",setter:function(X){if(X&&!this.get("title")){var W=X.split("/");this.set("title",W[W.length-1]);}return X;}},title:{value:""},autoLoad:{value:false},scrubber:{value:false},volumeControl:{value:false},time:{value:true},position:{value:0,setter:function(W){if(typeof W==="number"){return W;}}},volume:{value:50,setter:function(W){if(typeof W==="number"){return W;}}},BASIC_TEMPLATE:{value:"<div id='{id}' class='{className}'><p class='{titleClass}'>{title}</p><a href='#player' class='{playBtnClass}'>Play</a>{volumeBtn}{time}{scrubber}{volumeBar}</div>"},SCRUBBER_TEMPLATE:{value:"<div class='{scrubberClass} {barClass}'><div class='{loadbarClass}'>&nbsp;</div><div class='{playbarClass}'>&nbsp;</div></div>"},TIME_TEMPLATE:{value:"<span class='{elapsedClass}'>{elapsed}</span> <span class='{separatorClass}'>/</span> <span class='{totalClass}'>{total}</span>"},TIME_CONTAINER_TEMPLATE:{value:"<p class='{timeClass}'>{time}</p>"},VOLUME_BTN_TEMPLATE:{value:"<a href='#volume' class='{volumeBtnClass}'>Volume</a>"},VOLUME_BAR_TEMPLATE:{value:"<div class='{volumeClass} {barClass}'><div class='{volbarClass}'>&nbsp;</div></div>"}},HTML_PARSER:{url:function(W){return W.getAttribute("href");},title:function(W){var X=W.getAttribute("title");return X||null;},scrubber:function(W){return W.hasClass("scrubber");},time:function(W){return !W.hasClass("no-time");},volumeControl:function(W){return W.hasClass("volume");},autoLoad:function(W){return W.hasClass("autoload");}}});},"@VERSION@",{requires:["base","widget","get","event","event-custom","event-mousenter","substitute"]});